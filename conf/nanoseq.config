process {
    // === RESOURCE LIMITS ===
    resourceLimits = [ 
        cpus: params.max_cpus ?: 200, 
        memory: params.max_memory ?: 750.GB, 
        time: params.max_time ?: 30.d 
    ]

    // === SENSIBLE DEFAULTS ===
    // Most processes use minimal resources based on usage analysis
    cpus   = { 1 }
    memory = { 2.GB * task.attempt }
    time   = { 30.min * task.attempt }

    // === ERROR HANDLING ===
    errorStrategy = { 
        if (task.exitStatus in ((130..145) + 104)) {
            sleep(Math.pow(2, task.attempt) * 200 as long)  // Exponential backoff
            return 'retry'
        } else {
            return 'finish'
        }
    }
    maxRetries = 3
    maxErrors  = '-1'

    withLabel:error_ignore {
        errorStrategy = 'ignore'
    }
    withLabel:error_retry {
        errorStrategy = 'retry'
        maxRetries    = 2
    }

    // === PANEL CREATION PROCESSES ===
    // Large memory requirements for genomic position processing
    withName:'CREATEPANELS:SITESFROMPOSITIONS' {
        memory = { 60.GB }
        time   = { 30.min }
    }

    // VEP annotation is CPU and memory intensive for large VCFs
    withName:'CREATEPANELS:VCFANNOTATEPANEL:ENSEMBLVEP_VEP' {
        cpus   = { 24 }
        memory = { 24.GB }
        time   = { 32.h }
    }

    withName:'CREATEPANELS:CUSTOMPROCESSING.*' {
        memory = { 16.GB }
        time   = { 1.h }
    }

    withName:'(DEPTHS.*CONS|CREATEPANELS:DOMAINANNOTATION)' {
        cpus   = { 2 }
        memory = { 8.GB }
    }

    withName:'CREATEPANELS:CREATECAPTUREDPANELS' {
        memory = { 10.GB }
    }

    // Large consensus panels require substantial memory
    withName:'CREATEPANELS:CREATECONSENSUSPANELS.*' {
        memory = { 32.GB }
        time   = { 10.min }
    }

    // === ANALYSIS PROCESSES ===
    withName:ANNOTATEDEPTHS {
        memory = { 20.GB }
        time   = { 1.h }
    }

    withName:'MUT_PREPROCESSING:SUMANNOTATION' {
        cpus   = { 2 }
        memory = { 10.GB }
    }

    withName:'MUT_PREPROCESSING:PLOTMAF' {
        memory = { 16.GB }
        time   = { 15.min }
    }

    withName:'(CREATEPANELS:POSTPROCESSVEPPANEL|MUT_PREPROCESSING:SOMATICMUTATIONS|OMEGANONPROT.*:SUBSETPANEL)' {
        cpus   = { 2 }
        memory = { 4.GB }
    }

    withName:'MUTRATE.*:MUTRATE' {
        memory = { 8.GB }
    }

    withName:'OMEGA.*:(PREPROCESSING|ESTIMATOR).*' {
        memory = { 4.GB }
    }

    withName:'SIGNATURESNONPROT:SIGPROFILERASSIGNMENT' {
        memory = { 2.GB }
    }

    // === UTILITY PROCESSES ===
    withName:CUSTOM_DUMPSOFTWAREVERSIONS {
        cache = false
    }
}